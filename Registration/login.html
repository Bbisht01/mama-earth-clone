<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" data-auto-replace-svg="nest"></script>
    <link rel="stylesheet" href="login.css">
</head>
<body>

    
    
    <div id="loginContainer">
        <div>
        <!-- <div id="loginContainer-btn-a">show</div> -->
        <div id="loginContainer-btn-b"><i class="fas fa-times fa-lg"></i></div>
        </div>
        <div id="loginDiv">
            <h2>Log in to get started</h2>
            <div id="loginDiv-a">
                <img src="https://mamaearth.in/static/mamaearth/login.svg
                ">
            </div>
            <div id="loginDiv-b">
                <p>Get access to your orders, track<br>previous order & Redeem Mama<br>Cash</p>             
            </div>
            <input id="login-username" type="text" placeholder="Email">
            <input id="login-password" type="text" placeholder="Password">

            <p>By Continuing, you agree to Mamaearth's <a href="">Terms and Conditions</a>and<a href="">Privacy Policy</a></p>

            <div id="LWO">
                <button onclick="Login()">LOG IN</button>
                <p><a href="index.html">CONTINUE AS GUEST</a></p>
            </div>         



        </div>
    </div>

    
    
    
</body>

</html>
<script>

    // Api-Link-https://masai-api-mocker.herokuapp.com/

    // Register-https://masai-api-mocker.herokuapp.com/auth/register


async function Login(){
let login_data = {
    username : document.getElementById("login-username").value,
    password : document.getElementById("login-password").value,    
};

login_data = JSON.stringify(login_data);
console.log(login_data);

let login_api = `https://masai-api-mocker.herokuapp.com/auth/login`;


// Body-Send data to body

let response = await fetch(login_api,{
    method: "POST",
    body:login_data,

    // More extra info about my request
    headers:{
        "Content-Type": "application/json"
    },
});

let data = await response.json();
let name=document.getElementById("login-username").value;
console.log(data);

  console.log(data)
        if (data.error == false){
            userData(name, data.token)
           // window.location.href="sucs.html"
            //profileDetails(name,data.token)

        }else{
            alert("wrong credentials");

            // document.getElementById("error").textContent=data.message;
        }
}



async function userData(name,token){
        console.log(name,token)
        let url=`https://masai-api-mocker.herokuapp.com/user/${name}`

        let res=await fetch(url,{
            headers:{
                "Content-Type":"application/json",
                "Authorization": `Bearer ${token}`
            },
        })

        let data= await res.json();

        //console.log(data)
        console.log(data)
        let username=data.name;
        let email=data.email;
        //console.log(username,email);
        let user={
            login:true,
            name:username,
            email:email
        }
        console.log(user)
        localStorage.setItem("userDetail",JSON.stringify(user))
        window.location.href="sucs.html"
    }



</script>